---
layout: default
title: Contents available while offline
---

<div class="alert alert-success">
  <div class="wrap">
    <p class="alert__icon"><svg class="icon"><use xlink:href="#symbol-offline" /></svg></p>
    <p class="alert__message">Here is a list of pages you can read <strong>even when you're not connected!</strong></p>
  </div>
</div>
<section class="list hidden" id="cachedPages">
  <h2>Pages</h2>
  <ul class="list__items"></ul>
</section>
<section class="list hidden" id="cachedArticles">
  <h2>Articles</h2>
  <ul class="list__items"></ul>
</section>
<section class="list hidden" id="cachedLinks">
  <h2>Links</h2>
  <ul class="list__items"></ul>
</section>
<section class="list hidden" id="cachedTags">
  <h2>Tags</h2>
  <ul class="list__items"></ul>
</section>

<script>
// https://googlechrome.github.io/samples/service-worker/window-caches/

window.caches.open('pages').then(cache => {
  return cache.keys();
})
.then(requests => {
  requests.forEach(request => {
    const requestUrl = new URL(request.url);
    const requestPath = requestUrl.pathname;
    if (/^\/[0-9]{4}\/[0-9]{2}\/./.test(requestPath)) {
      addRequestToList(request, 'cachedArticles');
    } else {
      if (/^\/links\/[0-9]{4}\/[0-9]{2}\/./.test(requestPath)) {
        addRequestToList(request, 'cachedLinks');
      } else {
        if (/^\/tags\/./.test(requestPath)) {
          addRequestToList(request, 'cachedTags');
        } else {
          addRequestToList(request, 'cachedPages');
        }
      }
    }
  });
});

function addRequestToList(request, group) {
  const requestUrl = new URL(request.url);
  const requestPath = requestUrl.pathname;

  window.caches.open('pages').then(cache => {
    cache.match(request).then(item => {
      item.text().then(pageHtml => {
        let pageDom = document.createElement('html');
        pageDom.innerHTML = pageHtml;

        let pageTitle = pageDom.querySelector('h1').innerText;

        let linkElement = document.createElement('a');
        linkElement.href = request.url;
        linkElement.textContent = pageTitle;

        let h3Element = document.createElement('h3');
        h3Element.className = 'card__title';
        h3Element.appendChild(linkElement);

        let liElement = document.createElement('li');
        liElement.className = 'list__item';
        liElement.appendChild(h3Element);

        if (pageDom.querySelector('.main footer')) {
          let pageMeta = document.createElement('footer');
          pageMeta.innerHTML = pageDom.querySelector('.main footer').innerHTML;
          liElement.appendChild(pageMeta);
        }

        document.querySelector('#' + group + ' ul').appendChild(liElement);
        document.getElementById(group).classList.remove('hidden');
      })
    })
  });
}
</script>

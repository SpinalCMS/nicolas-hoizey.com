---
layout: null
permalink: /tools/algolia.json
---

{% from "macros/meta.njk" import meta %}

[
{% for entry in collections.articles %}
  {%- set absoluteEntryUrl -%}{{ entry.url | url | absoluteUrl(pkg.homepage) }}{%- endset -%}
  {%- set metaHtml %}{{ meta(entry) }}{%- endset -%}
  {
    "type": "articles",
    "lang": "{{ entry.data.lang }}",
		"title": "{{ entry.data.title | safe }}",
		"date": {{ entry.date | date('X')}},
		"date.lvl0": "{{ entry.date | date('YYYY')}}",
		"date.lvl1": "{{ entry.date | date('YYYY')}} > {{ entry.date | date('MM')}}",
		"date.lvl2": "{{ entry.date | date('YYYY')}} > {{ entry.date | date('MM')}} > {{ entry.date | date('DD')}}",
		"url": "{{ absoluteEntryUrl }}",
    "objectID": "{{ absoluteEntryUrl }}",
		"content": {{ entry.templateContent | cleanForAlgolia | striptags | jsonify | safe }},
    "excerpt": {{ entry.templateContent | excerpt | striptags | jsonify | safe }},
		"tags": [
      {% for tag in entry.data.tags %}
        "{{ tag }}"{%- if not loop.last -%},{% endif -%}
  {% endfor %}
		],
    "meta_html": {{ metaHtml | jsonify | safe }}
	}
  {%- if not loop.last -%},{% endif -%}
{% endfor %}
,
{% for entry in collections.links %}
  {%- set absoluteEntryUrl -%}{{ entry.url | url | absoluteUrl(pkg.homepage) }}{%- endset -%}
  {%- set authors -%}
  {%- if entry.data.authors -%}
    {%- for author in entry.data.authors -%}
      {%- if not loop.first -%}
        {%- if not loop.last -%}, {% else %} and {% endif -%}
      {%- endif -%}
      {%- if author.twitter -%}
        <img class="u-photo smallavatar" src="https://res.cloudinary.com/nho/image/twitter_name/{{ author.twitter }}" alt="{{ author.name }} avatar" width="24" height="24" />
      {% endif -%}
      {{ author.name }}
    {%- endfor %} wrote
  {%- endif -%}
  {%- endset -%}
  {%- set content -%}{{ authors }} the linked content.
{{ entry.templateContent }}{%- endset -%}
  {%- set metaHtml %}{{ meta(entry) }}{%- endset -%}
  {
    "type": "links",
    "lang": "{{ entry.data.lang }}",
    "surtitle": {{ authors | jsonify | safe }},
		"title": "{{ entry.data.title | safe }}",
		"date": {{ entry.date | date('X')}},
		"date.lvl0": "{{ entry.date | date('YYYY')}}",
		"date.lvl1": "{{ entry.date | date('YYYY')}} > {{ entry.date | date('MM')}}",
		"date.lvl2": "{{ entry.date | date('YYYY')}} > {{ entry.date | date('MM')}} > {{ entry.date | date('DD')}}",
		"url": "{{ absoluteEntryUrl }}",
		"objectID": "{{ absoluteEntryUrl }}",
    "illustration": {
      "src": "https://image.thum.io/get/width/1200/crop/800/noanimate/{{ entry.data.link }}",
      "alt": "screenshot of {{ entry.data.title | safe }}",
      "width": 1200,
      "height": 800
    },
		"content": {{ content | cleanForAlgolia | striptags | jsonify | safe }},
    "excerpt": {{ entry.templateContent | excerpt | striptags | jsonify | safe }},
		"tags": [
      {% for tag in entry.data.tags %}
        "{{ tag }}"{%- if not loop.last -%},{% endif -%}
  {% endfor %}
		],
    "meta_html": {{ metaHtml | jsonify | safe }}
	}
  {%- if not loop.last -%},{% endif -%}
{% endfor %}
,
{% for entry in collections.notes %}
  {%- set absoluteEntryUrl -%}{{ entry.url | url | absoluteUrl(pkg.homepage) }}{%- endset -%}
  {%- set metaHtml %}{{ meta(entry, true) }}{%- endset -%}
  {
    "type": "notes",
    "lang": "{{ entry.data.lang }}",
		"date": {{ entry.date | date('X')}},
		"date.lvl0": "{{ entry.date | date('YYYY')}}",
		"date.lvl1": "{{ entry.date | date('YYYY')}} > {{ entry.date | date('MM')}}",
		"date.lvl2": "{{ entry.date | date('YYYY')}} > {{ entry.date | date('MM')}} > {{ entry.date | date('DD')}}",
		"url": "{{ absoluteEntryUrl }}",
		"objectID": "{{ absoluteEntryUrl }}",
		"content": {{ entry.templateContent | cleanForAlgolia | striptags | jsonify | safe }},
    "excerpt": {{ entry.templateContent | noteToHtml | absoluteImagePath(entry.url) | jsonify | safe }},
		"tags": [
      {% for tag in entry.data.tags %}
        "{{ tag }}"{%- if not loop.last -%},{% endif -%}
  {% endfor %}
		],
    "meta_html": {{ metaHtml | jsonify | safe }}
	}
  {%- if not loop.last -%},{% endif -%}
{% endfor %}
,
{% for entry in collections.talks %}
  {%- set absoluteEntryUrl -%}{{ entry.url | url | absoluteUrl(pkg.homepage) }}{%- endset -%}
  {
    "type": "talks",
    "lang": "{{ entry.lang }}",
		"title": "{{ entry.data.title }}",
		"date": {{ entry.date | date('X')}},
		"date.lvl0": "{{ entry.date | date('YYYY')}}",
		"date.lvl1": "{{ entry.date | date('YYYY')}} > {{ entry.date | date('MM')}}",
		"date.lvl2": "{{ entry.date | date('YYYY')}} > {{ entry.date | date('MM')}} > {{ entry.date | date('DD')}}",
		"url": "{{ absoluteEntryUrl }}",
		"objectID": "{{ absoluteEntryUrl }}",
    "illustration": {
      "src": "{{ entry.data.illustration.src }}",
      "alt": "{{ entry.data.illustration.alt }}",
      "width": {{ entry.data.illustration.width }},
      "height": {{ entry.data.illustration.height }}
    },
		"content": {{ entry.templateContent | cleanForAlgolia | striptags | jsonify | safe }},
    "excerpt": {{ entry.templateContent | excerpt | striptags | jsonify | safe }},
		"tags": [
      {% for tag in entry.data.tags %}
        "{{ tag }}"{%- if not loop.last -%},{% endif -%}
  {% endfor %}
		],
    "meta_html": ""
	}
  {%- if not loop.last -%},{% endif -%}
{% endfor %}
]
